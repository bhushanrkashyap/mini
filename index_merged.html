<!DOCTYPE html>
<html lang="en" class="">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Algo Sphere</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">

<style>
/* ===== ROOT VARIABLES ===== */
:root {
    --primary-light: #4f46e5;
    --secondary-light: #10b981;
    --background-light: #f9fafb;
    --text-light: #1f2937;
    --border-light: #e5e7eb;
    --primary-dark: #6366f1;
    --secondary-dark: #34d399;
    --background-dark: #111827;
    --text-dark: #f9fafb;
    --border-dark: #374151;
}

/* ===== BASE STYLES ===== */
body {
    font-family: 'Inter', sans-serif;
    background-color: var(--background-light);
    color: var(--text-light);
    transition: background-color 0.3s, color 0.3s;
    margin: 0;
    padding: 0;
}

.dark body {
    background-color: var(--background-dark);
    color: var(--text-dark);
}

/* ===== NAVIGATION ===== */
.navbar {
    background-color: rgba(255, 255, 255, 0.8);
    backdrop-filter: saturate(180%) blur(20px);
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
}

.dark .navbar {
    background-color: rgba(17, 24, 39, 0.8);
}

/* ===== BUTTONS ===== */
.btn-primary {
    background-color: var(--primary-light);
    color: white;
    transition: all 0.2s ease-in-out;
}

.btn-primary:hover {
    background-color: #4338ca;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.dark .btn-primary {
    background-color: var(--primary-dark);
}

.dark .btn-primary:hover {
    background-color: #818cf8;
}

/* ===== CARDS ===== */
.card {
    background-color: white;
    border: 1px solid var(--border-light);
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
}

.dark .card {
    background-color: #1f2937;
    border-color: var(--border-dark);
}

/* ===== DATA VISUALIZATION ===== */
.data-box-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center;
    gap: 8px;
    padding: 16px;
    position: relative;
}

.data-box {
    width: 50px;
    height: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-weight: bold;
    font-size: 1.1rem;
    border-radius: 0.375rem;
    transition: all 0.3s ease-in-out;
    background-color: var(--primary-light);
    color: white;
    border: 2px solid transparent;
    position: relative;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.data-box:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.dark .data-box {
    background-color: var(--primary-dark);
}

/* ===== STACK STYLES ===== */
#stack-canvas-container {
    display: flex;
    justify-content: center;
    align-items: flex-end;
    min-height: 350px;
    border: 2px solid var(--border-light);
    border-radius: 8px;
    padding: 10px;
    background: linear-gradient(to bottom, rgba(79, 70, 229, 0.05), transparent);
}

.dark #stack-canvas-container {
    border-color: var(--border-dark);
    background: linear-gradient(to bottom, rgba(99, 102, 241, 0.05), transparent);
}

#stack-canvas {
    display: flex;
    flex-direction: column-reverse;
    gap: 5px;
}

/* ===== QUEUE STYLES ===== */
#queue-canvas-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 150px;
    border: 2px solid var(--border-light);
    border-radius: 8px;
    padding: 10px;
    background: linear-gradient(to right, rgba(79, 70, 229, 0.05), transparent);
}

.dark #queue-canvas-container {
    border-color: var(--border-dark);
    background: linear-gradient(to right, rgba(99, 102, 241, 0.05), transparent);
}

#queue-canvas {
    display: flex;
    flex-direction: row;
    gap: 5px;
}

/* ===== POINTER LABELS ===== */
.pointer-text {
    position: absolute;
    font-size: 0.8rem;
    font-weight: bold;
    color: var(--secondary-light);
    width: 100%;
    text-align: center;
    left: 0;
}

.dark .pointer-text {
    color: var(--secondary-dark);
}

/* ===== VISUALIZER NAVIGATION ===== */
.visualizer-nav-btn {
    border-bottom: 2px solid transparent;
    transition: all 0.2s ease;
    cursor: pointer;
}

.visualizer-nav-btn:hover {
    color: var(--primary-light);
}

.visualizer-nav-btn.active {
    border-bottom-color: var(--primary-light);
    color: var(--primary-light);
}

.dark .visualizer-nav-btn:hover {
    color: var(--primary-dark);
}

.dark .visualizer-nav-btn.active {
    border-bottom-color: var(--primary-dark);
    color: var(--primary-dark);
}

/* ===== FORM INPUTS ===== */
.form-input {
    width: 100%;
    padding: 0.5rem 1rem;
    background-color: white;
    border: 1px solid var(--border-light);
    border-radius: 0.375rem;
    transition: all 0.2s ease;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary-light);
    box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
}

.dark .form-input {
    background-color: #374151;
    border-color: var(--border-dark);
    color: var(--text-dark);
}

.dark .form-input:focus {
    border-color: var(--primary-dark);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

/* ===== LANDING PAGE ===== */
#landing-page {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

.dark #landing-page {
    background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
}

/* ===== ANIMATIONS ===== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.fade-in {
    animation: fadeIn 0.5s ease-in-out;
}

/* ===== UTILITY CLASSES ===== */
.hidden {
    display: none !important;
}

.flex {
    display: flex;
}

/* ===== RESPONSIVE DESIGN ===== */
@media (max-width: 768px) {
    .data-box {
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
    }
    
    #stack-canvas-container,
    #queue-canvas-container {
        min-height: 250px;
    }
}

/* ===== ENHANCED SORTING VISUALIZATIONS ===== */
.data-box-container {
    min-height: 220px;
    overflow: visible;
}

/* SVG Bar Chart Enhancements */
.sort-bar {
    transition: all 0.3s ease-in-out;
    cursor: pointer;
}

.sort-bar:hover {
    opacity: 0.8;
    filter: brightness(1.1);
}

/* Comparison visualizers */
#comp-visualizer-1,
#comp-visualizer-2 {
    position: relative;
    overflow: visible;
    background: rgba(99, 102, 241, 0.05);
    border-radius: 8px;
}

.dark #comp-visualizer-1,
.dark #comp-visualizer-2 {
    background: rgba(99, 102, 241, 0.1);
}

#comp-visualizer-1 svg,
#comp-visualizer-2 svg {
    display: block;
    margin: 0 auto;
}

/* Algorithm comparison result cards */
#comp-result-1,
#comp-result-2 {
    min-height: 320px;
}

/* Animated highlights for comparisons */
@keyframes pulseHighlight {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.05); }
}

.comparing {
    animation: pulseHighlight 0.5s ease-in-out infinite;
}

/* Complexity badges */
.complexity-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    font-family: 'Courier New', monospace;
}

.complexity-best {
    background-color: #d1fae5;
    color: #065f46;
}

.dark .complexity-best {
    background-color: #064e3b;
    color: #6ee7b7;
}

.complexity-avg {
    background-color: #fef3c7;
    color: #92400e;
}

.dark .complexity-avg {
    background-color: #78350f;
    color: #fcd34d;
}

.complexity-worst {
    background-color: #fee2e2;
    color: #991b1b;
}

.dark .complexity-worst {
    background-color: #7f1d1d;
    color: #fca5a5;
}


</style>
</head>
<body class="antialiased">
    <!-- Landing Page -->
    <div id="landing-page" class="flex flex-col items-center justify-center min-h-screen text-center bg-gray-50 dark:bg-gray-900">
        <div class="flex items-center justify-center mb-4">
            <svg class="h-12 w-12 text-indigo-500 dark:text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <h1 class="ml-3 text-5xl font-extrabold text-gray-900 dark:text-white">Algo Sphere</h1>
        </div>
        <p class="mt-4 max-w-2xl text-xl text-gray-500 dark:text-gray-400">
            The best place to visualize data structures and algorithms. <br> From theory to practice, all in one platform.
        </p>
        <div class="mt-10">
            <button id="start-learning-btn" class="px-8 py-4 text-lg font-semibold text-white transition-colors duration-200 transform bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Start Learning
            </button>
        </div>
    </div>


    <!-- Authentication Screen -->
    <div id="auth-screen" class="hidden flex-col items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900">
        <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg dark:bg-gray-800">
            <div class="text-center">
                <div class="flex items-center justify-center mb-4">
                    <svg class="h-10 w-10 text-indigo-500 dark:text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                    <span class="ml-2 text-3xl font-bold text-gray-900 dark:text-white">Algo Sphere</span>
                </div>
            </div>
            
            <!-- Login Form -->
            <div id="login-form">
                <h2 class="text-2xl font-bold text-center">Welcome Back!</h2>
                <p class="mt-2 text-sm text-center text-gray-600 dark:text-gray-400">Sign in to continue.</p>
                <div class="mt-6 space-y-4">
                    <div>
                        <label for="login-name" class="text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
                         <input id="login-name" type="text" placeholder="Enter your name" class="form-input mt-1">
                    </div>
                    <div>
                        <label for="login-password" class="text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                        <input id="login-password" type="password" placeholder="Enter your password" class="form-input mt-1">
                    </div>
                    <div>
                        <button id="loginBtn" class="w-full mt-2 px-4 py-2 font-semibold text-white transition-colors duration-200 transform bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Login
                        </button>
                    </div>
                    <p class="text-sm text-center">Don't have an account? <a href="#" id="show-signup" class="font-medium text-indigo-600 hover:underline dark:text-indigo-400">Sign Up</a></p>
                </div>
            </div>

            <!-- Sign Up Form -->
            <div id="signup-form" class="hidden">
                 <h2 class="text-2xl font-bold text-center">Create an Account</h2>
                 <p class="mt-2 text-sm text-center text-gray-600 dark:text-gray-400">Get started with Algo Sphere.</p>
                <div class="mt-6 space-y-4">
                     <div>
                        <label for="signup-name" class="text-sm font-medium text-gray-700 dark:text-gray-300">Name</label>
                         <input id="signup-name" type="text" placeholder="Choose a name" class="form-input mt-1">
                    </div>
                    <div>
                        <label for="signup-password" class="text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
                        <input id="signup-password" type="password" placeholder="Create a password" class="form-input mt-1">
                    </div>
                     <div>
                        <label for="signup-confirm-password" class="text-sm font-medium text-gray-700 dark:text-gray-300">Confirm Password</label>
                        <input id="signup-confirm-password" type="password" placeholder="Confirm your password" class="form-input mt-1">
                    </div>
                     <div>
                        <label for="signup-dob" class="text-sm font-medium text-gray-700 dark:text-gray-300">Date of Birth</label>
                        <input id="signup-dob" type="date" class="form-input mt-1">
                    </div>
                    <div>
                        <button id="signupBtn" class="w-full mt-2 px-4 py-2 font-semibold text-white transition-colors duration-200 transform bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Sign Up
                        </button>
                    </div>
                     <p class="text-sm text-center">Already have an account? <a href="#" id="show-login" class="font-medium text-indigo-600 hover:underline dark:text-indigo-400">Login</a></p>
                </div>
            </div>
        </div>
    </div>


    <!-- Main App Content (Initially Hidden) -->
    <div id="main-content" class="flex flex-col min-h-screen hidden">
        <!-- Navigation Bar -->
        <nav class="navbar sticky top-0 z-40 w-full border-b border-gray-200 dark:border-gray-700">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-16">
                    <div class="flex items-center">
                        <!-- User Profile Dropdown -->
                        <div class="relative">
                            <button id="user-profile-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                <svg class="h-8 w-8 text-gray-600 dark:text-gray-300" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </button>
                            <div id="user-profile-dropdown" class="origin-top-left absolute left-0 mt-2 w-48 rounded-md shadow-lg py-1 bg-white dark:bg-gray-800 ring-1 ring-black ring-opacity-5 hidden">
                                <div class="px-4 py-2 text-sm text-gray-700 dark:text-gray-200">
                                    <p class="font-semibold">Signed in as</p>
                                    <p id="dropdown-username" class="truncate">User</p>
                                </div>
                                <div class="border-t border-gray-100 dark:border-gray-700"></div>
                                <a href="#" id="profile-link" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">My Profile</a>
                                <a href="#" id="dashboard-link" class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700">Learning Dashboard</a>
                            </div>
                        </div>

                        <div class="flex items-center ml-4">
                             <svg class="h-8 w-8 text-indigo-500 dark:text-indigo-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <span class="ml-2 text-2xl font-bold text-gray-900 dark:text-white">Algo Sphere</span>
                        </div>
                    </div>
                    <div class="hidden md:block">
                        <div class="ml-10 flex items-baseline space-x-4">
                             <a href="#" id="home-link" class="text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                        </div>
                    </div>
                    <div class="flex items-center">
                         <!-- Dark Mode Toggle -->
                        <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                            <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                            <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 5.05a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM3 11a1 1 0 100-2H2a1 1 0 100 2h1z"></path></svg>
                        </button>
                        <button id="logoutButton" class="ml-4 btn-primary px-4 py-2 rounded-md text-sm font-medium">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <main class="flex-grow">
            <!-- Dashboard View -->
            <div id="dashboard-view">
                <section id="modules" class="py-20 bg-gray-50 dark:bg-gray-800">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                         <div class="lg:text-center">
                            <h2 class="text-base text-indigo-600 dark:text-indigo-400 font-semibold tracking-wide uppercase">Learning Path</h2>
                            <p class="mt-2 text-3xl leading-8 font-extrabold tracking-tight text-gray-900 dark:text-white sm:text-4xl">
                                Select a Data Structure
                            </p>
                             <div class="mt-8">
                                <button id="start-comparison-btn" class="btn-primary px-6 py-3 rounded-lg font-semibold">Compare Sorting Algorithms</button>
                            </div>
                        </div>
                        <div class="mt-12 grid gap-8 md:grid-cols-2 lg:grid-cols-2">
                            <div class="card rounded-lg shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" data-structure="arrays">
                               <h3 class="text-xl font-bold mb-2">Arrays & Sorting</h3>
                               <p class="text-gray-600 dark:text-gray-400 mb-4">Master fundamental sorting algorithms and array manipulations.</p>
                            </div>
                             <div class="card rounded-lg shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" data-structure="stacks">
                               <h3 class="text-xl font-bold mb-2">Stacks & Queues</h3>
                               <p class="text-gray-600 dark:text-gray-400 mb-4">Understand LIFO (Stack) and FIFO (Queue) data structures.</p>
                            </div>
                             <div class="card rounded-lg shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" data-structure="trees">
                               <h3 class="text-xl font-bold mb-2">Trees</h3>
                               <p class="text-gray-600 dark:text-gray-400 mb-4">Explore complex hierarchical data relationships and traversals.</p>
                            </div>
                            <div class="card rounded-lg shadow-md p-6 cursor-pointer hover:shadow-xl transition-shadow" data-structure="graphs">
                               <h3 class="text-xl font-bold mb-2">Graphs</h3>
                               <p class="text-gray-600 dark:text-gray-400 mb-4">Visualize nodes and edges, and learn pathfinding algorithms.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
            
            <!-- Profile View -->
            <div id="profile-view" class="hidden">
                 <section class="py-12 bg-gray-50 dark:bg-gray-800">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                         <button id="back-to-dashboard-from-profile" class="mb-4 text-indigo-600 dark:text-indigo-400 hover:underline">&larr; Back to Dashboard</button>
                         <div class="card p-8 rounded-xl shadow-lg text-center">
                            <img class="w-32 h-32 rounded-full mx-auto -mt-20 border-4 border-white dark:border-gray-800" src="https://placehold.co/128x128/6366f1/ffffff?text=AV" alt="User Avatar">
                            <h2 id="profile-username" class="mt-4 text-3xl font-bold text-gray-900 dark:text-white"></h2>
                            <p class="text-gray-500 dark:text-gray-400">Aspiring Algorithm Master</p>
                            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Progress</h3>
                                    <p class="mt-2 text-4xl font-bold text-indigo-600 dark:text-indigo-400">12/25</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Algorithms Mastered</p>
                                </div>
                                 <div class="p-6 bg-gray-100 dark:bg-gray-700 rounded-lg">
                                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Streak</h3>
                                    <p class="mt-2 text-4xl font-bold text-emerald-500 dark:text-emerald-400">ðŸ”¥ 7 Days</p>
                                    <p class="text-sm text-gray-500 dark:text-gray-400">Learning Streak</p>
                                </div>
                            </div>
                         </div>
                    </div>
                </section>
            </div>

            <!-- Visualizer View -->
            <div id="visualizer-view" class="hidden">
                 <section class="py-12 bg-gray-50 dark:bg-gray-800">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <button id="back-to-dashboard" class="mb-4 text-indigo-600 dark:text-indigo-400 hover:underline">&larr; Back to Dashboard</button>
                        
                        <div class="mt-4 card p-4 sm:p-6 lg:p-8 rounded-xl shadow-lg">
                             <!-- Visualizer Navigation -->
                             <div id="visualizer-nav" class="mb-4 border-b border-gray-200 dark:border-gray-700">
                                 <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                                     <button data-structure="arrays" class="visualizer-nav-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Arrays</button>
                                     <button data-structure="stacks" class="visualizer-nav-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Stack</button>
                                     <button data-structure="queues" class="visualizer-nav-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Queue</button>
                                     <button data-structure="trees" class="visualizer-nav-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Tree</button>
                                     <button data-structure="graphs" class="visualizer-nav-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Graph</button>
                                 </nav>
                             </div>

                            <h2 id="visualizer-title" class="text-center text-2xl mb-4 font-bold tracking-tight text-gray-900 dark:text-white"></h2>
                            
                             <!-- Array Canvas -->
                            <div id="array-visualizer" class="data-box-container bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[200px] sm:min-h-[250px]"></div>
                             <!-- Stack Canvas -->
                             <div id="stack-visualizer" class="hidden">
                                 <div id="stack-canvas-container">
                                     <div id="stack-canvas"></div>
                                 </div>
                             </div>
                             <!-- Queue Canvas -->
                             <div id="queue-visualizer" class="hidden">
                                 <div id="queue-canvas-container">
                                     <div id="queue-canvas"></div>
                                 </div>
                             </div>
                              <!-- Tree/Graph Canvas (Placeholder) -->
                            <div id="tree-graph-visualizer" class="hidden flex items-center justify-center bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[350px]">
                                 <p class="text-gray-500 dark:text-gray-400">Tree/Graph visualizations are coming soon!</p>
                            </div>

                             <!-- Array Manual Input -->
                            <div id="array-manual-controls" class="hidden mt-4 grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                                <div class="sm:col-span-2">
                                    <label for="manual-array-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Enter comma-separated numbers</label>
                                    <input type="text" id="manual-array-input" class="form-input mt-1" placeholder="e.g., 5,2,8,1,9">
                                </div>
                                <button id="load-manual-array-btn" class="w-full btn-primary px-4 py-2 rounded-md text-sm font-medium h-10">Load Array</button>
                            </div>
                            
                            <!-- Controls -->
                            <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-6 items-center">
                                <div class="space-y-4">
                                    <label for="algorithm-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Algorithm / Operation</label>
                                    <select id="algorithm-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                    </select>
                                </div>
                                
                                <div class="space-y-4" id="speed-control">
                                    <label for="speed-slider" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Animation Speed</label>
                                    <input id="speed-slider" type="range" min="100" max="1000" value="500" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-600">
                                </div>
                                 
                                 <!-- Algorithm-specific inputs -->
                                <div id="algo-specific-controls" class="space-y-4"></div>


                                <div class="flex space-x-2 md:col-start-3">
                                    <button id="start-btn" class="w-full btn-primary px-4 py-2 rounded-md text-sm font-medium">Run</button>
                                    <button id="reset-btn" class="w-full bg-gray-300 dark:bg-gray-600 px-4 py-2 rounded-md text-sm font-medium">Reset</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <!-- Comparison View -->
            <div id="comparison-view" class="hidden">
                 <section class="py-12 bg-gray-50 dark:bg-gray-800">
                    <div class="max-w-screen-xl mx-auto px-4 sm:px-6 lg:px-8">
                        <button id="back-to-dashboard-from-comp" class="mb-4 text-indigo-600 dark:text-indigo-400 hover:underline">&larr; Back to Dashboard</button>
                        <h2 class="text-center text-3xl mb-8 font-bold tracking-tight text-gray-900 dark:text-white">Compare Sorting Algorithms</h2>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- Left Visualizer -->
                            <div class="card p-4 rounded-xl shadow-lg">
                                <label for="algo1-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Algorithm 1</label>
                                <select id="algo1-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:bg-gray-700 dark:border-gray-600 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                                <div id="comp-visualizer-1" class="data-box-container bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[200px] mt-4"></div>
                                <div id="comp-result-1" class="mt-2 text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                            <!-- Right Visualizer -->
                            <div class="card p-4 rounded-xl shadow-lg">
                                 <label for="algo2-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Algorithm 2</label>
                                <select id="algo2-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:bg-gray-700 dark:border-indigo-600 dark:text-white focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"></select>
                                <div id="comp-visualizer-2" class="data-box-container bg-gray-100 dark:bg-gray-700 rounded-lg min-h-[200px] mt-4"></div>
                                <div id="comp-result-2" class="mt-2 text-sm text-gray-700 dark:text-gray-300"></div>
                            </div>
                        </div>
                        
                        <div class="mt-8 card p-4 rounded-xl shadow-lg grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                             <div>
                                <label for="comp-array-input" class="block text-sm font-medium text-gray-700 dark:text-gray-300">Shared Array (or leave blank for random)</label>
                                <input type="text" id="comp-array-input" class="form-input mt-1" placeholder="e.g., 8,3,5,1,9">
                            </div>
                            <div class="flex space-x-2">
                                <button id="run-comparison-btn" class="w-full btn-primary px-4 py-2 rounded-md font-medium">Run Comparison</button>
                                <button id="reset-comparison-btn" class="w-full bg-gray-300 dark:bg-gray-600 px-4 py-2 rounded-md font-medium">Reset</button>
                            </div>
                        </div>
                    </div>
                 </section>
            </div>
        </main>
        
        <footer class="bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700">
             <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8">
                <div class="mt-8 md:mt-0 md:order-1">
                    <p class="text-center text-base text-gray-400">&copy; 2025 Algo Sphere. Built for Mini Project by Bharath MN & Bhushan R Kaashyap.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- External JavaScript -->
    <script src="js/app.js"></script>

<script>
// ===== STATE MANAGEMENT =====
let isLoggedIn = false;
let userName = 'User';
let currentView = 'dashboard';
let currentStructure = '';
let arrayData = [];
let stackData = [];
let queueData = [];
let animationSpeed = 500;
let isAnimating = false;

// ===== DOM READY =====
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

function initializeApp() {
    // Get all DOM elements
    getDOMElements();
    
    // Setup event listeners
    setupEventListeners();
    
    // Apply initial theme
    applyTheme();
}

// ===== DOM ELEMENTS =====
let landingPage, startLearningBtn, authScreen, loginForm, signupForm;
let showSignupBtn, showLoginBtn, loginNameInput, signupNameInput;
let mainContent, dashboardView, visualizerView, profileView, comparisonView;
let homeLink, backToDashboardBtn, backToDashboardFromProfileBtn, backToDashboardFromCompBtn;
let loginBtn, signupBtn, logoutButton, userProfileBtn, userProfileDropdown;
let dropdownUsername, profileLink, dashboardLink, profileUsername;
let moduleCards, visualizerTitle, arrayVisualizer, stackVisualizer, queueVisualizer, treeGraphVisualizer;
let algorithmSelect, speedControl, algoSpecificControls, startBtn, resetBtn, speedSlider;
let visualizerNavBtns, arrayManualControls, manualArrayInput, loadManualArrayBtn;
let startComparisonBtn, algo1Select, algo2Select, compVisualizer1, compVisualizer2;
let compArrayInput, runComparisonBtn, resetComparisonBtn;
let themeToggleBtn, themeToggleDarkIcon, themeToggleLightIcon;
let html;

function getDOMElements() {
    landingPage = document.getElementById('landing-page');
    startLearningBtn = document.getElementById('start-learning-btn');
    authScreen = document.getElementById('auth-screen');
    loginForm = document.getElementById('login-form');
    signupForm = document.getElementById('signup-form');
    showSignupBtn = document.getElementById('show-signup');
    showLoginBtn = document.getElementById('show-login');
    loginNameInput = document.getElementById('login-name');
    signupNameInput = document.getElementById('signup-name');
    mainContent = document.getElementById('main-content');
    dashboardView = document.getElementById('dashboard-view');
    visualizerView = document.getElementById('visualizer-view');
    profileView = document.getElementById('profile-view');
    comparisonView = document.getElementById('comparison-view');
    
    homeLink = document.getElementById('home-link');
    backToDashboardBtn = document.getElementById('back-to-dashboard');
    backToDashboardFromProfileBtn = document.getElementById('back-to-dashboard-from-profile');
    backToDashboardFromCompBtn = document.getElementById('back-to-dashboard-from-comp');
    
    loginBtn = document.getElementById('loginBtn');
    signupBtn = document.getElementById('signupBtn');
    logoutButton = document.getElementById('logoutButton');
    userProfileBtn = document.getElementById('user-profile-btn');
    userProfileDropdown = document.getElementById('user-profile-dropdown');
    dropdownUsername = document.getElementById('dropdown-username');
    profileLink = document.getElementById('profile-link');
    dashboardLink = document.getElementById('dashboard-link');
    profileUsername = document.getElementById('profile-username');
    
    moduleCards = document.querySelectorAll('#modules .card');
    
    visualizerTitle = document.getElementById('visualizer-title');
    arrayVisualizer = document.getElementById('array-visualizer');
    stackVisualizer = document.getElementById('stack-visualizer');
    queueVisualizer = document.getElementById('queue-visualizer');
    treeGraphVisualizer = document.getElementById('tree-graph-visualizer');

    algorithmSelect = document.getElementById('algorithm-select');
    speedControl = document.getElementById('speed-control');
    algoSpecificControls = document.getElementById('algo-specific-controls');
    startBtn = document.getElementById('start-btn');
    resetBtn = document.getElementById('reset-btn');
    speedSlider = document.getElementById('speed-slider');
    visualizerNavBtns = document.querySelectorAll('.visualizer-nav-btn');
    arrayManualControls = document.getElementById('array-manual-controls');
    manualArrayInput = document.getElementById('manual-array-input');
    loadManualArrayBtn = document.getElementById('load-manual-array-btn');

    startComparisonBtn = document.getElementById('start-comparison-btn');
    algo1Select = document.getElementById('algo1-select');
    algo2Select = document.getElementById('algo2-select');
    compVisualizer1 = document.getElementById('comp-visualizer-1');
    compVisualizer2 = document.getElementById('comp-visualizer-2');
    compArrayInput = document.getElementById('comp-array-input');
    runComparisonBtn = document.getElementById('run-comparison-btn');
    resetComparisonBtn = document.getElementById('reset-comparison-btn');

    themeToggleBtn = document.getElementById('theme-toggle');
    themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

    html = document.documentElement;
}

// ===== ALGORITHM/OPERATIONS MAPPING =====
const structureOptions = {
    arrays: { 
        title: "Array & Algorithm Visualizer", 
        algorithms: [
            "Bubble Sort", "Selection Sort", "Insertion Sort", "Merge Sort", "Quick Sort",
            "Linear Search", "Binary Search", 
            "Insert", "Delete"
        ] 
    },
    stacks: { title: "Stack Visualizer", algorithms: ["Push", "Pop"] },
    queues: { title: "Queue Visualizer", algorithms: ["Enqueue", "Dequeue"] },
    trees: { title: "Tree Visualizer", algorithms: ["BST Insert", "BST Search", "In-order Traversal"] },
    graphs: { title: "Graph Visualizer", algorithms: ["Breadth-First Search", "Depth-First Search"] }
};

// ===== COMPLEXITY MAPPING =====
    // Detailed complexity mapping for algorithms
    const complexityMap = {
        'Bubble Sort': {
            time: { best: 'O(n)', average: 'O(nÂ²)', worst: 'O(nÂ²)' },
            space: 'O(1)',
            stable: true,
            description: 'Repeatedly swaps adjacent elements if they are in wrong order'
        },
        'Selection Sort': {
            time: { best: 'O(nÂ²)', average: 'O(nÂ²)', worst: 'O(nÂ²)' },
            space: 'O(1)',
            stable: false,
            description: 'Finds minimum element and places it at the beginning'
        },
        'Insertion Sort': {
            time: { best: 'O(n)', average: 'O(nÂ²)', worst: 'O(nÂ²)' },
            space: 'O(1)',
            stable: true,
            description: 'Builds sorted array one item at a time by inserting elements'
        },
        'Merge Sort': {
            time: { best: 'O(n log n)', average: 'O(n log n)', worst: 'O(n log n)' },
            space: 'O(n)',
            stable: true,
            description: 'Divides array into halves, sorts them and merges back'
        },
        'Quick Sort': {
            time: { best: 'O(n log n)', average: 'O(n log n)', worst: 'O(nÂ²)' },
            space: 'O(log n)',
            stable: false,
            description: 'Picks pivot and partitions array around it recursively'
        },
        'Heap Sort': {
            time: { best: 'O(n log n)', average: 'O(n log n)', worst: 'O(n log n)' },
            space: 'O(1)',
            stable: false,
            description: 'Builds max heap and extracts maximum elements repeatedly'
        },
        'JavaScript Built-in': {
            time: { best: 'O(n log n)', average: 'O(n log n)', worst: 'O(n log n)' },
            space: 'O(log n)',
            stable: true,
            description: 'Optimized Timsort (hybrid of merge sort and insertion sort)'
        }
    };

// ===== EVENT LISTENERS SETUP =====
function setupEventListeners() {
    // Authentication
    startLearningBtn.addEventListener('click', handleStartLearning);
    showSignupBtn.addEventListener('click', handleShowSignup);
    showLoginBtn.addEventListener('click', handleShowLogin);
    loginBtn.addEventListener('click', handleLogin);
    signupBtn.addEventListener('click', handleSignup);
    logoutButton.addEventListener('click', handleLogout);
    
    // Profile dropdown
    userProfileBtn.addEventListener('click', toggleProfileDropdown);
    window.addEventListener('click', handleOutsideClick);
    
    // Navigation
    homeLink.addEventListener('click', (e) => { e.preventDefault(); showDashboard(); });
    dashboardLink.addEventListener('click', (e) => { e.preventDefault(); showDashboard(); });
    profileLink.addEventListener('click', (e) => { e.preventDefault(); showProfile(); });
    startComparisonBtn.addEventListener('click', showComparison);
    backToDashboardBtn.addEventListener('click', showDashboard);
    backToDashboardFromProfileBtn.addEventListener('click', showDashboard);
    backToDashboardFromCompBtn.addEventListener('click', showDashboard);
    
    // Module cards
    moduleCards.forEach(card => {
        card.addEventListener('click', () => showVisualizer(card.dataset.structure));
    });
    
    // Visualizer navigation
    visualizerNavBtns.forEach(btn => {
        btn.addEventListener('click', () => showVisualizer(btn.dataset.structure));
    });
    
    // Algorithm controls
    loadManualArrayBtn.addEventListener('click', loadManualArray);
    startBtn.addEventListener('click', runAlgorithm);
    resetBtn.addEventListener('click', resetData);
    algorithmSelect.addEventListener('change', updateAlgoSpecificControls);
    speedSlider.addEventListener('input', handleSpeedChange);
    
    // Comparison
    runComparisonBtn.addEventListener('click', runComparison);
    resetComparisonBtn.addEventListener('click', resetComparison);
    
    // Theme
    themeToggleBtn.addEventListener('click', toggleTheme);
    
    // Window resize
    window.addEventListener('resize', handleWindowResize);
}

// ===== THEME MANAGEMENT =====
function applyTheme() {
    const isDark = localStorage.getItem('color-theme') === 'dark' || 
                   (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
    
    if (isDark) {
        themeToggleLightIcon.classList.remove('hidden');
        themeToggleDarkIcon.classList.add('hidden');
        html.classList.add('dark');
    } else {
        themeToggleDarkIcon.classList.remove('hidden');
        themeToggleLightIcon.classList.add('hidden');
        html.classList.remove('dark');
    }
}

function toggleTheme() {
    html.classList.toggle('dark');
    localStorage.setItem('color-theme', html.classList.contains('dark') ? 'dark' : 'light');
    applyTheme();
    if(currentView === 'visualizer') renderCurrentStructure();
}

// ===== AUTHENTICATION HANDLERS =====
function handleStartLearning() {
    landingPage.classList.add('hidden');
    landingPage.classList.add('fade-in');
    
    if (isLoggedIn) {
        mainContent.classList.remove('hidden');
        showDashboard();
    } else {
        // Auto-login for demo purposes
        performLogin('Demo User');
    }
}

function performLogin(name) {
    isLoggedIn = true;
    userName = name || 'User';
    dropdownUsername.textContent = userName;
    profileUsername.textContent = userName;
    authScreen.classList.add('hidden');
    authScreen.classList.remove('flex');
    mainContent.classList.remove('hidden');
    mainContent.classList.add('fade-in');
    showDashboard();
}

function handleShowSignup(e) {
    e.preventDefault();
    loginForm.classList.add('hidden');
    signupForm.classList.remove('hidden');
}

function handleShowLogin(e) {
    e.preventDefault();
    signupForm.classList.add('hidden');
    loginForm.classList.remove('hidden');
}

function handleLogin() {
    const name = loginNameInput.value.trim();
    if (name) performLogin(name);
}

function handleSignup() {
    const name = signupNameInput.value.trim();
    if (name) performLogin(name);
}

function handleLogout() {
    isLoggedIn = false;
    mainContent.classList.add('hidden');
    landingPage.classList.remove('hidden');
    currentView = 'landing';
}

function toggleProfileDropdown() {
    userProfileDropdown.classList.toggle('hidden');
}

function handleOutsideClick(e) {
    if (!userProfileBtn.contains(e.target) && !userProfileDropdown.contains(e.target)) {
        userProfileDropdown.classList.add('hidden');
    }
}

// ===== NAVIGATION & VIEW MANAGEMENT =====
function hideAllViews() {
    [dashboardView, visualizerView, profileView, comparisonView].forEach(v => {
        v.classList.add('hidden');
    });
}

function showDashboard() {
    hideAllViews();
    dashboardView.classList.remove('hidden');
    dashboardView.classList.add('fade-in');
    currentView = 'dashboard';
}

function showProfile() {
    hideAllViews();
    profileView.classList.remove('hidden');
    profileView.classList.add('fade-in');
    currentView = 'profile';
}

function showComparison() {
    hideAllViews();
    comparisonView.classList.remove('hidden');
    comparisonView.classList.add('fade-in');
    currentView = 'comparison';
    setupComparisonView();
}

function showVisualizer(structure) {
    currentStructure = structure;
    hideAllViews();
    visualizerView.classList.remove('hidden');
    visualizerView.classList.add('fade-in');
    currentView = 'visualizer';
    
    visualizerNavBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.structure === structure);
    });
    
    [arrayVisualizer, stackVisualizer, queueVisualizer, treeGraphVisualizer].forEach(v => {
        v.classList.add('hidden');
    });

    const options = structureOptions[structure];
    visualizerTitle.textContent = options.title;
    algorithmSelect.innerHTML = options.algorithms.map(alg => `<option>${alg}</option>`).join('');

    arrayManualControls.classList.add('hidden');
    
    if (structure === 'arrays') {
        arrayVisualizer.classList.remove('hidden');
        arrayManualControls.classList.remove('hidden');
        speedControl.classList.remove('hidden');
        resetBtn.textContent = 'New Array';
    } else if (structure === 'stacks' || structure === 'queues') {
        const visualizer = structure === 'stacks' ? stackVisualizer : queueVisualizer;
        visualizer.classList.remove('hidden');
        speedControl.classList.add('hidden');
        resetBtn.textContent = structure === 'stacks' ? 'Clear Stack' : 'Clear Queue';
    } else { 
        treeGraphVisualizer.classList.remove('hidden');
        speedControl.classList.add('hidden');
    }
    
    updateAlgoSpecificControls();
    resetData();
}

// ===== DATA MANAGEMENT =====
function sleep(ms) { 
    return new Promise(resolve => setTimeout(resolve, ms)); 
}

function resetData() {
    isAnimating = false;
    
    if (currentStructure === 'arrays') {
        const size = Math.floor(arrayVisualizer.clientWidth / 60);
        arrayData = d3.shuffle(d3.range(1, Math.max(5, size)));
    } else if (currentStructure === 'stacks') {
        stackData = [3, 1, 4];
    } else if (currentStructure === 'queues') {
        queueData = [3, 1, 4];
    }
    
    renderCurrentStructure();
}

function renderCurrentStructure() {
    if (currentStructure === 'arrays') renderArray(arrayData, "#array-visualizer");
    if (currentStructure === 'stacks') renderStack();
    if (currentStructure === 'queues') renderQueue();
}

function loadManualArray() {
    const input = manualArrayInput.value.trim();
    if (input) {
        const parsed = input.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
        if (parsed.length > 0) {
            arrayData = parsed;
            renderArray(arrayData, "#array-visualizer");
        }
    }
}

// ===== ARRAY RENDERING =====
function renderArray(data, containerSelector, pointers = {}) {
    const canvas = d3.select(containerSelector);
    canvas.html("");
    
    const selection = canvas.selectAll("div.data-box")
        .data(data, (d, i) => i) 
        .enter()
        .append("div")
        .attr("class", "data-box")
        .text(d => d);

    selection.each(function(d, i) {
        if (pointers[i]) {
            const pointerLabels = Array.isArray(pointers[i]) ? pointers[i] : [pointers[i]];
            pointerLabels.forEach((label, labelIndex) => {
                d3.select(this).append('span')
                    .attr('class', 'pointer-text')
                    .style('bottom', (-25 - (labelIndex * 20)) + 'px')
                    .text(label);
            });
        }
    });

    updateColors(containerSelector);
}

// ===== ANIMATED SORTING ALGORITHMS =====
async function bubbleSort(arr, helpers) {
    let n = arr.length;
    for (let i = 0; i < n - 1; i++) {
        for (let j = 0; j < n - i - 1; j++) {
            if(!isAnimating) { helpers.render(arr); return; }
            
            helpers.highlight(j, j + 1, "var(--secondary-light)");
            await sleep(animationSpeed);
            
            if (arr[j] > arr[j + 1]) {
                helpers.highlight(j, j + 1, "red");
                await sleep(animationSpeed);
                
                [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                helpers.render(arr);
                helpers.highlight(j, j + 1, "red");
                await sleep(animationSpeed);
            }
            
            helpers.unhighlight(j, j+1);
        }
    }
    helpers.render(arr);
}

// Selection Sort - Animated
async function selectionSort(arr, helpers) {
    const n = arr.length;
    for (let i = 0; i < n - 1; i++) {
        if(!isAnimating) { helpers.render(arr); return; }
        
        let minIdx = i;
        helpers.highlight(i, i, '#10b981'); // Green for current position
        await sleep(animationSpeed);
        
        for (let j = i + 1; j < n; j++) {
            if(!isAnimating) { helpers.render(arr); return; }
            
            helpers.highlight(j, j, '#f59e0b'); // Orange for scanning
            await sleep(animationSpeed * 0.7);
            
            if (arr[j] < arr[minIdx]) {
                if (minIdx !== i) helpers.unhighlight(minIdx, minIdx);
                minIdx = j;
                helpers.highlight(minIdx, minIdx, '#ef4444'); // Red for current minimum
            } else {
                helpers.unhighlight(j, j);
            }
        }
        
        if (minIdx !== i) {
            helpers.highlight(i, minIdx, '#dc2626'); // Dark red for swap
            await sleep(animationSpeed);
            
            [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
            helpers.render(arr);
            await sleep(animationSpeed);
        }
        
        helpers.unhighlight(i, minIdx);
    }
    helpers.render(arr);
}

// Insertion Sort - Animated
async function insertionSort(arr, helpers) {
    const n = arr.length;
    for (let i = 1; i < n; i++) {
        if(!isAnimating) { helpers.render(arr); return; }
        
        const key = arr[i];
        let j = i - 1;
        
        helpers.highlight(i, i, '#10b981'); // Green for element to insert
        await sleep(animationSpeed);
        
        while (j >= 0 && arr[j] > key) {
            if(!isAnimating) { helpers.render(arr); return; }
            
            helpers.highlight(j, j + 1, '#f59e0b'); // Orange for shifting
            await sleep(animationSpeed * 0.8);
            
            arr[j + 1] = arr[j];
            helpers.render(arr);
            await sleep(animationSpeed * 0.5);
            
            helpers.unhighlight(j, j + 1);
            j--;
        }
        
        arr[j + 1] = key;
        helpers.render(arr);
        helpers.highlight(j + 1, j + 1, 'lightgreen');
        await sleep(animationSpeed * 0.5);
        helpers.unhighlight(j + 1, j + 1);
    }
    helpers.render(arr);
}

// Merge Sort - Enhanced visualization showing divide, sort, and merge
async function mergeSort(arr, helpers, start = 0, end = null) {
    if (end === null) end = arr.length - 1;
    if (start >= end) return;
    if(!isAnimating) { helpers.render(arr); return; }
    
    const mid = Math.floor((start + end) / 2);
    
    // Step 1: Show DIVIDE phase - highlight the section being divided
    helpers.highlightRange(start, end, '#e0e7ff'); // Light blue background for division
    const dividePointers = {};
    dividePointers[start] = 'â¬‡ï¸DIV';
    dividePointers[mid] = 'â¬‡ï¸MID';
    dividePointers[end] = 'â¬‡ï¸DIV';
    helpers.render(arr, dividePointers);
    await sleep(animationSpeed * 1.5);
    
    // Show left section
    helpers.highlightRange(start, mid, '#a78bfa'); // Purple for left half
    const leftPointers = {};
    leftPointers[start] = 'â†LEFT';
    leftPointers[mid] = 'â†LEFT';
    helpers.render(arr, leftPointers);
    await sleep(animationSpeed);
    helpers.unhighlightRange(start, mid);
    
    // Show right section
    helpers.highlightRange(mid + 1, end, '#fbbf24'); // Yellow for right half
    const rightPointers = {};
    rightPointers[mid + 1] = 'RIGHTâ†’';
    rightPointers[end] = 'RIGHTâ†’';
    helpers.render(arr, rightPointers);
    await sleep(animationSpeed);
    helpers.unhighlightRange(mid + 1, end);
    
    // Step 2: Recursively SORT left and right halves
    await mergeSort(arr, helpers, start, mid);
    await mergeSort(arr, helpers, mid + 1, end);
    
    // Step 3: MERGE the sorted halves
    await merge(arr, helpers, start, mid, end);
}

async function merge(arr, helpers, start, mid, end) {
    if(!isAnimating) return;
    
    const leftArr = arr.slice(start, mid + 1);
    const rightArr = arr.slice(mid + 1, end + 1);
    
    // Show the two sorted subarrays before merging
    helpers.highlightRange(start, mid, '#c7d2fe'); // Light purple for sorted left
    helpers.highlightRange(mid + 1, end, '#fef3c7'); // Light yellow for sorted right
    const premergePointers = {};
    premergePointers[start] = `L[${leftArr.join(',')}]`;
    premergePointers[mid + 1] = `R[${rightArr.join(',')}]`;
    helpers.render(arr, premergePointers);
    await sleep(animationSpeed * 1.2);
    
    let i = 0, j = 0, k = start;
    
    // Highlight the merge area
    helpers.highlightRange(start, end, '#d1fae5'); // Light green for merge area
    const mergePointers = {};
    mergePointers[start] = 'â¬‡ï¸MERGE';
    mergePointers[end] = 'â¬‡ï¸MERGE';
    helpers.render(arr, mergePointers);
    await sleep(animationSpeed);
    
    // Merge process with detailed visualization
    while (i < leftArr.length && j < rightArr.length) {
        if(!isAnimating) return;
        
        const mergeProgress = {};
        mergeProgress[k] = `â¬‡ï¸${k - start + 1}/${end - start + 1}`;
        
        if (leftArr[i] <= rightArr[j]) {
            arr[k] = leftArr[i];
            helpers.render(arr, mergeProgress);
            helpers.highlight(k, k, '#10b981'); // Green for placed from left
            await sleep(animationSpeed);
            i++;
        } else {
            arr[k] = rightArr[j];
            helpers.render(arr, mergeProgress);
            helpers.highlight(k, k, '#34d399'); // Lighter green for placed from right
            await sleep(animationSpeed);
            j++;
        }
        k++;
    }
    
    // Copy remaining elements from left array
    while (i < leftArr.length) {
        if(!isAnimating) return;
        arr[k] = leftArr[i];
        const mergeProgress = {};
        mergeProgress[k] = `â¬‡ï¸${k - start + 1}/${end - start + 1}`;
        helpers.render(arr, mergeProgress);
        helpers.highlight(k, k, '#10b981');
        await sleep(animationSpeed * 0.7);
        i++;
        k++;
    }
    
    // Copy remaining elements from right array
    while (j < rightArr.length) {
        if(!isAnimating) return;
        arr[k] = rightArr[j];
        const mergeProgress = {};
        mergeProgress[k] = `â¬‡ï¸${k - start + 1}/${end - start + 1}`;
        helpers.render(arr, mergeProgress);
        helpers.highlight(k, k, '#34d399');
        await sleep(animationSpeed * 0.7);
        j++;
        k++;
    }
    
    // Show final merged section
    helpers.highlightRange(start, end, '#10b981'); // Green for fully merged
    const finalPointers = {};
    finalPointers[start] = 'âœ…MERGED';
    finalPointers[end] = 'âœ…MERGED';
    helpers.render(arr, finalPointers);
    await sleep(animationSpeed * 1.2);
    
    helpers.unhighlightRange(start, end);
}

// Quick Sort - Animated with pivot visualization
async function quickSort(arr, helpers, low = 0, high = null) {
    if (high === null) high = arr.length - 1;
    if (low < high) {
        if(!isAnimating) { helpers.render(arr); return; }
        
        const pi = await partition(arr, helpers, low, high);
        await quickSort(arr, helpers, low, pi - 1);
        await quickSort(arr, helpers, pi + 1, high);
    }
}

async function partition(arr, helpers, low, high) {
    if(!isAnimating) return high;
    
    const pivot = arr[high];
    
    // Highlight pivot
    helpers.highlight(high, high, '#a78bfa'); // Purple for pivot
    await sleep(animationSpeed);
    
    let i = low - 1;
    
    for (let j = low; j < high; j++) {
        if(!isAnimating) return high;
        
        helpers.highlight(j, j, '#f59e0b'); // Orange for current element
        await sleep(animationSpeed * 0.7);
        
        if (arr[j] < pivot) {
            i++;
            
            if (i !== j) {
                helpers.highlight(i, j, '#ef4444'); // Red for swap
                await sleep(animationSpeed * 0.8);
                
                [arr[i], arr[j]] = [arr[j], arr[i]];
                helpers.render(arr);
                await sleep(animationSpeed * 0.5);
            }
        }
        
        helpers.unhighlight(j, j);
    }
    
    // Place pivot in correct position
    i++;
    helpers.highlight(i, high, '#10b981'); // Green for final swap
    await sleep(animationSpeed);
    
    [arr[i], arr[high]] = [arr[high], arr[i]];
    helpers.render(arr);
    await sleep(animationSpeed);
    
    helpers.unhighlight(i, high);
    
    return i;
}

// Heap Sort - Shows actual heap tree construction
async function heapSort(arr, helpers) {
    const n = arr.length;
    
    // Step 1: Build max heap - show tree structure
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
        if(!isAnimating) { helpers.render(arr); return; }
        await heapify(arr, helpers, n, i, true);
    }
    
    // Show completed max heap with tree structure
    const heapPointers = buildHeapTreePointers(arr, n);
    helpers.highlightRange(0, n - 1, '#10b981');
    helpers.render(arr, heapPointers);
    await sleep(animationSpeed * 2);
    helpers.unhighlightRange(0, n - 1);
    
    // Step 2: Extract elements one by one
    for (let i = n - 1; i > 0; i--) {
        if(!isAnimating) { helpers.render(arr); return; }
        
        // Swap root with last element
        helpers.highlight(0, i, '#ef4444');
        await sleep(animationSpeed);
        
        [arr[0], arr[i]] = [arr[i], arr[0]];
        helpers.render(arr);
        await sleep(animationSpeed * 0.8);
        
        // Mark as sorted
        helpers.highlight(i, i, '#10b981');
        await sleep(animationSpeed * 0.5);
        
        // Heapify the reduced heap
        await heapify(arr, helpers, i, 0, false);
    }
    
    helpers.render(arr);
}

// Build visual representation of heap tree
function buildHeapTreePointers(arr, n) {
    const pointers = {};
    for (let i = 0; i < n; i++) {
        const left = 2 * i + 1;
        const right = 2 * i + 2;
        let label = '';
        
        if (i === 0) {
            label = 'Root';
        } else {
            const parent = Math.floor((i - 1) / 2);
            if (2 * parent + 1 === i) {
                label = 'â†™L';
            } else {
                label = 'â†˜R';
            }
        }
        pointers[i] = label;
    }
    return pointers;
}

async function heapify(arr, helpers, n, i, isBuildPhase) {
    if(!isAnimating) return;
    
    let largest = i;
    const left = 2 * i + 1;
    const right = 2 * i + 2;
    
    // Show parent-child relationship in heap tree
    const heapPointers = {};
    heapPointers[i] = `P:${arr[i]}`;
    if (left < n) heapPointers[left] = `L:${arr[left]}`;
    if (right < n) heapPointers[right] = `R:${arr[right]}`;
    
    helpers.render(arr, heapPointers);
    
    // Highlight the subtree
    const toHighlight = [i];
    if (left < n) toHighlight.push(left);
    if (right < n) toHighlight.push(right);
    
    toHighlight.forEach(idx => helpers.highlight(idx, idx, '#fef3c7'));
    await sleep(animationSpeed);
    
    // Find largest
    if (left < n && arr[left] > arr[largest]) {
        largest = left;
        helpers.highlight(left, left, '#fbbf24');
        await sleep(animationSpeed * 0.5);
    }
    
    if (right < n && arr[right] > arr[largest]) {
        if (largest !== i) helpers.highlight(largest, largest, '#fef3c7');
        largest = right;
        helpers.highlight(right, right, '#fbbf24');
        await sleep(animationSpeed * 0.5);
    }
    
    if (largest !== i) {
        // Show the swap in heap structure
        const swapPointers = {};
        swapPointers[i] = `â‡… ${arr[i]}`;
        swapPointers[largest] = `â‡… ${arr[largest]}`;
        helpers.render(arr, swapPointers);
        helpers.highlight(i, largest, '#a78bfa');
        await sleep(animationSpeed);
        
        [arr[i], arr[largest]] = [arr[largest], arr[i]];
        
        // Show updated heap
        const updatedPointers = {};
        updatedPointers[i] = `P:${arr[i]}`;
        if (left < n) updatedPointers[left] = `L:${arr[left]}`;
        if (right < n) updatedPointers[right] = `R:${arr[right]}`;
        helpers.render(arr, updatedPointers);
        await sleep(animationSpeed * 0.8);
        
        toHighlight.forEach(idx => helpers.unhighlight(idx, idx));
        
        // Recursively heapify the affected subtree
        await heapify(arr, helpers, n, largest, isBuildPhase);
    } else {
        toHighlight.forEach(idx => helpers.unhighlight(idx, idx));
    }
}

// Linear Search - Animated with clean UI
async function linearSearch(helpers) {
    const target = parseInt(document.getElementById('search-value').value);
    
    if (isNaN(target)) {
        alert('Please enter a valid search value!');
        return;
    }
    
    for (let i = 0; i < arrayData.length; i++) {
        if(!isAnimating) { helpers.render(arrayData); return; }
        
        helpers.highlight(i, i, '#f59e0b'); // Orange for checking
        await sleep(animationSpeed);
        
        if (arrayData[i] === target) {
            // Found! Just highlight green
            helpers.highlight(i, i, '#10b981'); // Green for found
            helpers.render(arrayData);
            await sleep(animationSpeed * 3);
            helpers.unhighlight(i, i);
            helpers.render(arrayData);
            return;
        }
        
        helpers.unhighlight(i, i);
    }
    
    // Not found
    helpers.highlightRange(0, arrayData.length - 1, '#fee2e2');
    helpers.render(arrayData);
    await sleep(animationSpeed * 2);
    helpers.unhighlightRange(0, arrayData.length - 1);
    helpers.render(arrayData);
}

// Binary Search - Animated with clean UI
async function binarySearch(helpers) {
    const target = parseInt(document.getElementById('search-value').value);
    
    if (isNaN(target)) {
        alert('Please enter a valid search value!');
        return;
    }
    
    // Sort the array silently
    arrayData.sort((a, b) => a - b);
    helpers.render(arrayData);
    await sleep(animationSpeed * 0.5);
    
    let left = 0;
    let right = arrayData.length - 1;
    
    while (left <= right) {
        if(!isAnimating) { helpers.render(arrayData); return; }
        
        const mid = Math.floor((left + right) / 2);
        
        // Highlight search range and show pointers
        helpers.highlightRange(left, right, '#e0e7ff');
        const pointers = { 
            [left]: 'L', 
            [right]: 'R', 
            [mid]: `M=${arrayData[mid]}` 
        };
        helpers.render(arrayData, pointers);
        helpers.highlight(mid, mid, '#f59e0b');
        await sleep(animationSpeed * 1.2);
        
        if (arrayData[mid] === target) {
            // Found! Just highlight green
            helpers.highlight(mid, mid, '#10b981');
            helpers.render(arrayData);
            await sleep(animationSpeed * 3);
            helpers.unhighlightRange(0, arrayData.length - 1);
            helpers.render(arrayData);
            return;
        }
        
        if (arrayData[mid] < target) {
            // Search right half
            helpers.unhighlightRange(left, mid);
            left = mid + 1;
        } else {
            // Search left half
            helpers.unhighlightRange(mid, right);
            right = mid - 1;
        }
    }
    
    // Not found
    helpers.highlightRange(0, arrayData.length - 1, '#fee2e2');
    helpers.render(arrayData);
    await sleep(animationSpeed * 2);
    helpers.unhighlightRange(0, arrayData.length - 1);
    helpers.render(arrayData);
}

// ===== PURE (NON-ANIMATED) SORTING ALGORITHMS =====
function bubbleSortSync(arr) {
    let a = arr.slice();
    let n = a.length;
    for (let i = 0; i < n - 1; i++) {
        for (let j = 0; j < n - i - 1; j++) {
            if (a[j] > a[j+1]) [a[j], a[j+1]] = [a[j+1], a[j]];
        }
    }
    return a;
}

function selectionSortSync(arr) {
    let a = arr.slice();
    for (let i = 0; i < a.length; i++) {
        let minIdx = i;
        for (let j = i+1; j < a.length; j++) {
            if (a[j] < a[minIdx]) minIdx = j;
        }
        if (minIdx !== i) [a[i], a[minIdx]] = [a[minIdx], a[i]];
    }
    return a;
}

function insertionSortSync(arr) {
    let a = arr.slice();
    for (let i = 1; i < a.length; i++) {
        let key = a[i];
        let j = i - 1;
        while (j >= 0 && a[j] > key) {
            a[j+1] = a[j];
            j--;
        }
        a[j+1] = key;
    }
    return a;
}

function mergeSortSync(arr) {
    if (arr.length <= 1) return arr.slice();
    
    const mid = Math.floor(arr.length / 2);
    const left = mergeSortSync(arr.slice(0, mid));
    const right = mergeSortSync(arr.slice(mid));
    const res = [];
    
    let i = 0, j = 0;
    while(i < left.length && j < right.length) {
        if (left[i] <= right[j]) res.push(left[i++]); 
        else res.push(right[j++]);
    }
    
    while(i < left.length) res.push(left[i++]);
    while(j < right.length) res.push(right[j++]);
    
    return res;
}

function quickSortSync(arr) {
    if (arr.length <= 1) return arr.slice();
    
    const a = arr.slice();
    const pivot = a[Math.floor(a.length/2)];
    const left = a.filter(x => x < pivot);
    const middle = a.filter(x => x === pivot);
    const right = a.filter(x => x > pivot);
    
    return quickSortSync(left).concat(middle, quickSortSync(right));
}

function heapSortSync(arr) {
    let a = arr.slice();
    
    function heapify(n, i) {
        let largest = i;
        const l = 2*i + 1;
        const r = 2*i + 2;
        
        if (l < n && a[l] > a[largest]) largest = l;
        if (r < n && a[r] > a[largest]) largest = r;
        
        if (largest !== i) {
            [a[i], a[largest]] = [a[largest], a[i]];
            heapify(n, largest);
        }
    }
    
    const n = a.length;
    for (let i = Math.floor(n/2) - 1; i >= 0; i--) heapify(n, i);
    for (let i = n - 1; i > 0; i--) {
        [a[0], a[i]] = [a[i], a[0]];
        heapify(i, 0);
    }
    
    return a;
}

function getPureSortByName(name) {
    const sortFunctions = {
        'Bubble Sort': bubbleSortSync,
        'Selection Sort': selectionSortSync,
        'Insertion Sort': insertionSortSync,
        'Merge Sort': mergeSortSync,
        'Quick Sort': quickSortSync,
        'Heap Sort': heapSortSync,
        'JS Built-in Sort': (arr) => arr.slice().sort((a,b) => a-b)
    };
    
    return sortFunctions[name] || sortFunctions['JS Built-in Sort'];
}

// ===== ARRAY OPERATIONS =====
async function insertElement(helpers) {
    const val = parseInt(document.getElementById('value-to-insert').value);
    const index = parseInt(document.getElementById('index-to-insert').value);

    if (isNaN(val) || isNaN(index) || index < 0 || index > arrayData.length) {
        alert('Please enter valid value and index!');
        return;
    }
    
    arrayData.splice(index, 0, val);
    helpers.render(arrayData);
    await sleep(animationSpeed);
    helpers.highlight(index, index, 'lightgreen');
}

async function deleteElement(helpers) {
    const index = parseInt(document.getElementById('index-to-delete').value);
    
    if (isNaN(index) || index < 0 || index >= arrayData.length) {
        alert('Please enter a valid index!');
        return;
    }
    
    helpers.highlight(index, index, 'red');
    await sleep(animationSpeed);
    
    arrayData.splice(index, 1);
    helpers.render(arrayData);
}

async function twoPointers(helpers) {
    const target = parseInt(document.getElementById('target-sum').value);
    if (isNaN(target)) {
        alert('Please enter a valid target sum!');
        return;
    }

    let arr = [...arrayData].sort((a,b) => a - b);
    helpers.render(arr);
    await sleep(animationSpeed * 2);

    let left = 0;
    let right = arr.length - 1;

    while (left < right) {
        if(!isAnimating) { helpers.render(arr); return; }
        
        helpers.render(arr, { [left]: 'L', [right]: 'R' });
        helpers.highlight(left, right, 'var(--secondary-light)');
        await sleep(animationSpeed);

        const sum = arr[left] + arr[right];
        if (sum === target) {
            helpers.highlight(left, right, 'lightgreen');
            return;
        } else if (sum < target) {
            helpers.unhighlight(left, right);
            left++;
        } else {
            helpers.unhighlight(left, right);
            right--;
        }
    }
    
    helpers.render(arr);
}

async function slidingWindow(helpers) {
    const k = parseInt(document.getElementById('window-size').value);
    
    if (isNaN(k) || k <= 0 || k > arrayData.length) {
        alert('Please enter a valid window size!');
        return;
    }

    let maxSum = -Infinity;
    let bestWindowStart = -1;
    let currentSum = 0;

    for(let i = 0; i < k; i++) {
        currentSum += arrayData[i];
    }
    maxSum = currentSum;
    bestWindowStart = 0;

    for (let i = k; i < arrayData.length; i++) {
        if(!isAnimating) { helpers.render(arrayData); return; }
        
        helpers.highlightRange(i - k, i, 'var(--secondary-light)');
        await sleep(animationSpeed);
        
        currentSum = currentSum - arrayData[i - k] + arrayData[i];
        if (currentSum > maxSum) {
            maxSum = currentSum;
            bestWindowStart = i - k + 1;
        }
        helpers.unhighlightRange(i-k, i);
    }
    
    helpers.highlightRange(bestWindowStart, bestWindowStart + k - 1, 'lightgreen');
}

// ===== STACK OPERATIONS =====
function renderStack() {
    console.log('renderStack called, stackData:', stackData);
    const canvas = d3.select("#stack-canvas");
    canvas.html("");
    
    if (stackData.length === 0) {
        console.log('Stack is empty');
        return;
    }
    
    canvas.selectAll("div.data-box")
        .data(stackData, (d, i) => i)
        .enter()
        .append("div")
        .attr("class", "data-box")
        .style("transform", "translateY(50px)")
        .style("opacity", 0)
        .text(d => d)
        .transition()
        .duration(300)
        .style("transform", "translateY(0)")
        .style("opacity", 1);
        
    updateColors("#stack-canvas");
}

async function stackPush() {
    console.log('stackPush called');
    if (isAnimating) {
        console.log('Already animating, returning');
        return;
    }
    
    const inputElement = document.getElementById('value-input');
    let val;
    
    if (inputElement && inputElement.value.trim() !== '') {
        val = parseInt(inputElement.value);
        console.log('Using input value:', val);
    } else {
        const promptVal = prompt('Enter a value to push onto the stack:');
        if (promptVal === null || promptVal.trim() === '') return;
        val = parseInt(promptVal);
        console.log('Using prompt value:', val);
    }
    
    if (isNaN(val)) {
        alert('Please enter a valid number!');
        return;
    }
    
    console.log('Pushing value to stack:', val);
    isAnimating = true;
    stackData.push(val);
    console.log('Stack data after push:', stackData);
    renderStack();
    await sleep(300);
    if (inputElement) inputElement.value = "";
    isAnimating = false;
    console.log('stackPush completed');
}

async function stackPop() {
    console.log('stackPop called');
    if(isAnimating) {
        console.log('Already animating, returning');
        return;
    }
    
    if(stackData.length === 0) {
        alert('Stack is empty!');
        return;
    }
    
    console.log('Popping from stack, current data:', stackData);
    isAnimating = true;
    const canvas = d3.select("#stack-canvas");
    const lastBox = canvas.select("div.data-box:last-child");
    
    if (!lastBox.empty()) {
        lastBox
            .transition()
            .duration(300)
            .style("transform", "translateY(50px)")
            .style("opacity", 0)
            .end()
            .then(() => { 
                stackData.pop();
                console.log('Stack data after pop:', stackData); 
                renderStack(); 
                isAnimating = false; 
            })
            .catch(() => {
                stackData.pop();
                console.log('Stack data after pop (catch):', stackData); 
                renderStack(); 
                isAnimating = false;
            });
    } else {
        stackData.pop();
        console.log('Stack data after pop (no animation):', stackData); 
        renderStack(); 
        isAnimating = false;
    }
}

// ===== QUEUE OPERATIONS =====
function renderQueue() {
    console.log('renderQueue called, queueData:', queueData);
    const canvas = d3.select("#queue-canvas");
    canvas.html("");
    
    if (queueData.length === 0) {
        console.log('Queue is empty');
        return;
    }
    
    canvas.selectAll("div.data-box")
        .data(queueData, (d, i) => i)
        .enter()
        .append("div")
        .attr("class", "data-box")
        .text(d => d)
        .each(function(d, i) {
            if (i === 0) {
                d3.select(this).append('span')
                    .attr('class', 'pointer-text')
                    .style('bottom', '-25px')
                    .text('Front');
            }
            if (i === queueData.length - 1 && queueData.length > 1) {
                d3.select(this).append('span')
                    .attr('class', 'pointer-text')
                    .style('bottom', '-45px')
                    .text('Rear');
            }
        });
        
    updateColors("#queue-canvas");
}

async function queueEnqueue() {
    console.log('queueEnqueue called');
    if (isAnimating) {
        console.log('Already animating, returning');
        return;
    }
    
    const inputElement = document.getElementById('value-input');
    let val;
    
    if (inputElement && inputElement.value.trim() !== '') {
        val = parseInt(inputElement.value);
        console.log('Using input value:', val);
    } else {
        const promptVal = prompt('Enter a value to enqueue:');
        if (promptVal === null || promptVal.trim() === '') return;
        val = parseInt(promptVal);
        console.log('Using prompt value:', val);
    }
    
    if (isNaN(val)) {
        alert('Please enter a valid number!');
        return;
    }
    
    console.log('Enqueueing value:', val);
    isAnimating = true;
    queueData.push(val);
    console.log('Queue data after enqueue:', queueData);
    renderQueue();
    await sleep(300);
    if (inputElement) inputElement.value = "";
    isAnimating = false;
    console.log('queueEnqueue completed');
}

async function queueDequeue() {
    console.log('queueDequeue called');
    if(isAnimating) {
        console.log('Already animating, returning');
        return;
    }
    
    if(queueData.length === 0) {
        alert('Queue is empty!');
        return;
    }
    
    console.log('Dequeueing from queue, current data:', queueData);
    isAnimating = true;
    const canvas = d3.select("#queue-canvas");
    const firstBox = canvas.select("div.data-box:first-child");
    
    if (!firstBox.empty()) {
        firstBox
            .transition()
            .duration(300)
            .style("transform", "translateX(-50px)")
            .style("opacity", 0)
            .end()
            .then(() => { 
                queueData.shift();
                console.log('Queue data after dequeue:', queueData); 
                renderQueue(); 
                isAnimating = false; 
            })
            .catch(() => {
                queueData.shift();
                console.log('Queue data after dequeue (catch):', queueData); 
                renderQueue(); 
                isAnimating = false;
            });
    } else {
        queueData.shift();
        console.log('Queue data after dequeue (no animation):', queueData); 
        renderQueue(); 
        isAnimating = false;
    }
}

// ===== COMPARISON VIEW =====
function setupComparisonView() {
    const sortingAlgos = structureOptions.arrays.algorithms.filter(a => a.includes("Sort"));
    const optionsHtml = sortingAlgos.map(alg => `<option>${alg}</option>`).join('');
    
    algo1Select.innerHTML = optionsHtml;
    algo2Select.innerHTML = optionsHtml;
    algo2Select.selectedIndex = 1;
    
    resetComparison();
}

function resetComparison() {
    isAnimating = false;
    let arr;
    const input = compArrayInput.value.trim();
    
    if (input) {
        arr = input.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
    } else {
        const size = Math.floor(compVisualizer1.clientWidth / 60);
        arr = d3.shuffle(d3.range(1, Math.max(5, size)));
    }
    
    renderArray([...arr], "#comp-visualizer-1");
    renderArray([...arr], "#comp-visualizer-2");
    
    // Clear results
    document.getElementById('comp-result-1').innerHTML = '';
    document.getElementById('comp-result-2').innerHTML = '';
}

async function runComparison() {
    if (isAnimating) return;
    
    isAnimating = true;
    try {
        let arr;
        const input = compArrayInput.value.trim();
        
        if (input) {
            arr = input.split(',').map(s => parseInt(s.trim())).filter(n => !isNaN(n));
        } else {
            const size = Math.floor(compVisualizer1.clientWidth / 60);
            arr = d3.shuffle(d3.range(1, Math.max(5, size)));
        }

        const algo1 = algo1Select.value;
        const algo2 = algo2Select.value;

        // Show initial unsorted arrays
        renderComparisonArrayEnhanced(compVisualizer1, arr, algo1);
        renderComparisonArrayEnhanced(compVisualizer2, arr, algo2);

        const result1 = document.getElementById('comp-result-1');
        const result2 = document.getElementById('comp-result-2');
        
        result1.innerHTML = '<span class="text-gray-500 text-sm">Sorting...</span>';
        result2.innerHTML = '<span class="text-gray-500 text-sm">Sorting...</span>';

        // Run with animated visualization
        await sleep(1000); // Longer initial pause
        
        const stats1 = await runSortWithAnimation(algo1, arr.slice(), compVisualizer1);
        const stats2 = await runSortWithAnimation(algo2, arr.slice(), compVisualizer2);

        // Display detailed results
        displayDetailedResults(algo1, stats1, result1, stats1.time < stats2.time ? 'faster' : stats1.time > stats2.time ? 'slower' : 'tie');
        displayDetailedResults(algo2, stats2, result2, stats2.time < stats1.time ? 'faster' : stats2.time > stats1.time ? 'slower' : 'tie');
    } finally {
        isAnimating = false;
    }
}

// Enhanced D3.js visualization with bar heights
function renderComparisonArrayEnhanced(container, arr, algoName) {
    const width = container.clientWidth;
    const height = 200;
    const maxVal = d3.max(arr) || 100;
    const barWidth = Math.min(50, (width - 20) / arr.length);
    
    // Clear container
    d3.select(container).html('');
    
    // Create SVG
    const svg = d3.select(container)
        .append('svg')
        .attr('width', width)
        .attr('height', height)
        .style('background', 'transparent');
    
    // Create bars with height proportional to value
    const bars = svg.selectAll('g')
        .data(arr)
        .enter()
        .append('g')
        .attr('transform', (d, i) => `translate(${i * barWidth + 10}, ${height - 30})`);
    
    bars.append('rect')
        .attr('class', 'sort-bar')
        .attr('width', barWidth - 4)
        .attr('height', 0)
        .attr('y', 0)
        .attr('fill', html.classList.contains('dark') ? '#6366f1' : '#4f46e5')
        .attr('rx', 3)
        .transition()
        .duration(800) // Slower initial render
        .attr('height', d => (d / maxVal) * 150)
        .attr('y', d => -(d / maxVal) * 150);
    
    bars.append('text')
        .attr('x', (barWidth - 4) / 2)
        .attr('y', 15)
        .attr('text-anchor', 'middle')
        .attr('fill', html.classList.contains('dark') ? '#f9fafb' : '#1f2937')
        .attr('font-size', '11px')
        .attr('font-weight', 'bold')
        .text(d => d);
}

// Run sort with animated visualization
async function runSortWithAnimation(algoName, arr, container) {
    const comparisons = { count: 0 };
    const swaps = { count: 0 };
    const accesses = { count: 0 };
    
    const startTime = performance.now();
    
    // For simple algorithms, we can animate them
    if (['Bubble Sort', 'Selection Sort', 'Insertion Sort', 'Merge Sort', 'Quick Sort'].includes(algoName)) {
        await animatedSort(algoName, arr, container, comparisons, swaps, accesses);
    } else {
        // For complex algorithms, just run them fast
        const sortFn = getPureSortByName(algoName);
        sortFn(arr);
        renderComparisonArrayEnhanced(container, arr, algoName);
    }
    
    const endTime = performance.now();
    
    return {
        time: endTime - startTime,
        comparisons: comparisons.count,
        swaps: swaps.count,
        accesses: accesses.count
    };
}

// Animated sorting with D3.js transitions
async function animatedSort(algoName, arr, container, comparisons, swaps, accesses) {
    const n = arr.length;
    const delay = Math.max(300, 2000 / n); // Slower animations for better visibility
    
    switch(algoName) {
        case 'Bubble Sort':
            for (let i = 0; i < n - 1; i++) {
                for (let j = 0; j < n - i - 1; j++) {
                    comparisons.count++;
                    accesses.count += 2;
                    
                    // Highlight comparison
                    highlightBars(container, [j, j + 1], '#f59e0b');
                    await sleep(delay * 1.5);
                    
                    if (arr[j] > arr[j + 1]) {
                        swaps.count++;
                        [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                        
                        // Animate swap
                        await updateBarsWithAnimation(container, arr, [j, j + 1]);
                        await sleep(delay * 1.2);
                    }
                    
                    unhighlightBars(container, [j, j + 1]);
                }
            }
            break;
            
        case 'Selection Sort':
            for (let i = 0; i < n - 1; i++) {
                let minIdx = i;
                highlightBars(container, [i], '#10b981');
                
                for (let j = i + 1; j < n; j++) {
                    comparisons.count++;
                    accesses.count += 2;
                    
                    highlightBars(container, [j], '#f59e0b');
                    await sleep(delay * 1.3);
                    
                    if (arr[j] < arr[minIdx]) {
                        unhighlightBars(container, [minIdx]);
                        minIdx = j;
                        highlightBars(container, [minIdx], '#ef4444');
                    } else {
                        unhighlightBars(container, [j]);
                    }
                }
                
                if (minIdx !== i) {
                    swaps.count++;
                    [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
                    await updateBarsWithAnimation(container, arr, [i, minIdx]);
                    await sleep(delay * 1.5);
                }
                
                unhighlightBars(container, [i, minIdx]);
            }
            break;
            
        case 'Insertion Sort':
            for (let i = 1; i < n; i++) {
                let key = arr[i];
                let j = i - 1;
                
                highlightBars(container, [i], '#10b981');
                await sleep(delay * 1.5);
                
                while (j >= 0 && arr[j] > key) {
                    comparisons.count++;
                    accesses.count += 2;
                    swaps.count++;
                    
                    arr[j + 1] = arr[j];
                    highlightBars(container, [j, j + 1], '#f59e0b');
                    await updateBarsWithAnimation(container, arr, [j, j + 1]);
                    await sleep(delay * 1.2);
                    unhighlightBars(container, [j, j + 1]);
                    j--;
                }
                
                arr[j + 1] = key;
                await updateBarsWithAnimation(container, arr, [j + 1]);
                await sleep(delay * 1.2);
                unhighlightBars(container, [j + 1]);
            }
            break;
            
        case 'Merge Sort':
            await mergeSortComparison(arr, container, comparisons, swaps, accesses, 0, n - 1, delay);
            break;
            
        case 'Quick Sort':
            await quickSortComparison(arr, container, comparisons, swaps, accesses, 0, n - 1, delay);
            break;
    }
    
    // Final sorted animation
    renderComparisonArrayEnhanced(container, arr, algoName);
}

// Merge Sort for comparison view
async function mergeSortComparison(arr, container, comparisons, swaps, accesses, start, end, delay) {
    if (start >= end) return;
    
    const mid = Math.floor((start + end) / 2);
    
    // Highlight dividing section
    for (let i = start; i <= end; i++) {
        highlightBars(container, [i], '#a78bfa');
    }
    await sleep(delay * 0.8);
    
    await mergeSortComparison(arr, container, comparisons, swaps, accesses, start, mid, delay);
    await mergeSortComparison(arr, container, comparisons, swaps, accesses, mid + 1, end, delay);
    await mergeComparison(arr, container, comparisons, swaps, accesses, start, mid, end, delay);
}

async function mergeComparison(arr, container, comparisons, swaps, accesses, start, mid, end, delay) {
    const leftArr = arr.slice(start, mid + 1);
    const rightArr = arr.slice(mid + 1, end + 1);
    
    let i = 0, j = 0, k = start;
    
    while (i < leftArr.length && j < rightArr.length) {
        comparisons.count++;
        accesses.count += 2;
        
        highlightBars(container, [k], '#fbbf24');
        
        if (leftArr[i] <= rightArr[j]) {
            arr[k] = leftArr[i];
            i++;
        } else {
            arr[k] = rightArr[j];
            j++;
        }
        
        await updateBarsWithAnimation(container, arr, [k]);
        await sleep(delay * 0.7);
        unhighlightBars(container, [k]);
        k++;
    }
    
    while (i < leftArr.length) {
        accesses.count++;
        arr[k] = leftArr[i];
        await updateBarsWithAnimation(container, arr, [k]);
        await sleep(delay * 0.5);
        i++;
        k++;
    }
    
    while (j < rightArr.length) {
        accesses.count++;
        arr[k] = rightArr[j];
        await updateBarsWithAnimation(container, arr, [k]);
        await sleep(delay * 0.5);
        j++;
        k++;
    }
}

// Quick Sort for comparison view
async function quickSortComparison(arr, container, comparisons, swaps, accesses, low, high, delay) {
    if (low < high) {
        const pi = await partitionComparison(arr, container, comparisons, swaps, accesses, low, high, delay);
        await quickSortComparison(arr, container, comparisons, swaps, accesses, low, pi - 1, delay);
        await quickSortComparison(arr, container, comparisons, swaps, accesses, pi + 1, high, delay);
    }
}

async function partitionComparison(arr, container, comparisons, swaps, accesses, low, high, delay) {
    const pivot = arr[high];
    highlightBars(container, [high], '#a78bfa'); // Pivot
    await sleep(delay * 0.8);
    
    let i = low - 1;
    
    for (let j = low; j < high; j++) {
        comparisons.count++;
        accesses.count += 2;
        
        highlightBars(container, [j], '#f59e0b');
        await sleep(delay * 0.6);
        
        if (arr[j] < pivot) {
            i++;
            if (i !== j) {
                swaps.count++;
                [arr[i], arr[j]] = [arr[j], arr[i]];
                await updateBarsWithAnimation(container, arr, [i, j]);
                await sleep(delay * 0.7);
            }
        }
        unhighlightBars(container, [j]);
    }
    
    i++;
    swaps.count++;
    [arr[i], arr[high]] = [arr[high], arr[i]];
    await updateBarsWithAnimation(container, arr, [i, high]);
    await sleep(delay);
    unhighlightBars(container, [high]);
    
    return i;
}

// Heap Sort for comparison view
async function heapSortComparison(arr, container, comparisons, swaps, accesses, delay) {
    const n = arr.length;
    
    // Build max heap
    for (let i = Math.floor(n / 2) - 1; i >= 0; i--) {
        await heapifyComparison(arr, container, comparisons, swaps, accesses, n, i, delay);
    }
    
    // Extract elements
    for (let i = n - 1; i > 0; i--) {
        swaps.count++;
        highlightBars(container, [0, i], '#ef4444');
        await sleep(delay);
        
        [arr[0], arr[i]] = [arr[i], arr[0]];
        await updateBarsWithAnimation(container, arr, [0, i]);
        await sleep(delay * 0.8);
        
        highlightBars(container, [i], '#10b981'); // Sorted
        await heapifyComparison(arr, container, comparisons, swaps, accesses, i, 0, delay);
    }
}

async function heapifyComparison(arr, container, comparisons, swaps, accesses, n, i, delay) {
    let largest = i;
    const left = 2 * i + 1;
    const right = 2 * i + 2;
    
    const toCheck = [i];
    if (left < n) toCheck.push(left);
    if (right < n) toCheck.push(right);
    
    toCheck.forEach(idx => highlightBars(container, [idx], '#fbbf24'));
    await sleep(delay * 0.6);
    
    if (left < n) {
        comparisons.count++;
        accesses.count += 2;
        if (arr[left] > arr[largest]) largest = left;
    }
    
    if (right < n) {
        comparisons.count++;
        accesses.count += 2;
        if (arr[right] > arr[largest]) largest = right;
    }
    
    if (largest !== i) {
        swaps.count++;
        [arr[i], arr[largest]] = [arr[largest], arr[i]];
        await updateBarsWithAnimation(container, arr, [i, largest]);
        await sleep(delay * 0.7);
        toCheck.forEach(idx => unhighlightBars(container, [idx]));
        await heapifyComparison(arr, container, comparisons, swaps, accesses, n, largest, delay);
    } else {
        toCheck.forEach(idx => unhighlightBars(container, [idx]));
    }
}

// Highlight specific bars
function highlightBars(container, indices, color) {
    const svg = d3.select(container).select('svg');
    svg.selectAll('g').each(function(d, i) {
        if (indices.includes(i)) {
            d3.select(this).select('rect').attr('fill', color);
        }
    });
}

// Unhighlight bars
function unhighlightBars(container, indices) {
    const svg = d3.select(container).select('svg');
    const defaultColor = html.classList.contains('dark') ? '#6366f1' : '#4f46e5';
    svg.selectAll('g').each(function(d, i) {
        if (indices.includes(i)) {
            d3.select(this).select('rect').attr('fill', defaultColor);
        }
    });
}

// Update bars with animation
async function updateBarsWithAnimation(container, arr, indices) {
    const svg = d3.select(container).select('svg');
    const maxVal = d3.max(arr) || 100;
    
    svg.selectAll('g').each(function(d, i) {
        if (indices.includes(i)) {
            const newVal = arr[i];
            d3.select(this).select('rect')
                .transition()
                .duration(400) // Slower bar updates
                .attr('height', (newVal / maxVal) * 150)
                .attr('y', -(newVal / maxVal) * 150);
            
            d3.select(this).select('text')
                .text(newVal);
        }
    });
}

// Display detailed results with complexity info
function displayDetailedResults(algoName, stats, container, status) {
    const complexity = complexityMap[algoName];
    
    if (!complexity) {
        container.innerHTML = `<span class="text-red-500">Error: Algorithm not found</span>`;
        return;
    }
    
    let icon = '';
    let statusColor = '';
    let statusText = '';
    
    if (status === 'faster') {
        icon = 'ðŸ†';
        statusColor = 'text-green-600 dark:text-green-400';
        statusText = 'Faster';
    } else if (status === 'slower') {
        icon = 'ðŸŒ';
        statusColor = 'text-red-600 dark:text-red-400';
        statusText = 'Slower';
    } else {
        icon = 'ðŸ¤';
        statusColor = 'text-blue-600 dark:text-blue-400';
        statusText = 'Tie';
    }
    
    container.innerHTML = `
        <div class="space-y-3 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700">
            <div class="${statusColor} text-lg font-bold flex items-center gap-2">
                <span class="text-2xl">${icon}</span>
                <span>${statusText}</span>
            </div>
            
            <div class="space-y-1 text-sm">
                <div class="flex justify-between items-center py-1 border-b border-gray-200 dark:border-gray-700">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">â±ï¸ Execution Time:</span>
                    <span class="font-mono font-bold text-indigo-600 dark:text-indigo-400">${stats.time.toFixed(3)} ms</span>
                </div>
                <div class="flex justify-between items-center py-1 border-b border-gray-200 dark:border-gray-700">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">ðŸ”„ Comparisons:</span>
                    <span class="font-mono">${stats.comparisons}</span>
                </div>
                <div class="flex justify-between items-center py-1 border-b border-gray-200 dark:border-gray-700">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">â†”ï¸ Swaps:</span>
                    <span class="font-mono">${stats.swaps}</span>
                </div>
                <div class="flex justify-between items-center py-1">
                    <span class="font-semibold text-gray-700 dark:text-gray-300">ï¿½ Array Accesses:</span>
                    <span class="font-mono">${stats.accesses}</span>
                </div>
            </div>
            
            <div class="mt-3 pt-3 border-t-2 border-gray-300 dark:border-gray-600">
                <div class="text-xs font-bold mb-2 text-gray-800 dark:text-gray-200">â° Time Complexity:</div>
                <div class="grid grid-cols-3 gap-2 text-xs mb-2">
                    <div class="bg-green-100 dark:bg-green-900 p-2 rounded text-center">
                        <div class="font-semibold text-green-800 dark:text-green-200">Best</div>
                        <div class="font-mono text-green-900 dark:text-green-100">${complexity.time.best}</div>
                    </div>
                    <div class="bg-yellow-100 dark:bg-yellow-900 p-2 rounded text-center">
                        <div class="font-semibold text-yellow-800 dark:text-yellow-200">Average</div>
                        <div class="font-mono text-yellow-900 dark:text-yellow-100">${complexity.time.average}</div>
                    </div>
                    <div class="bg-red-100 dark:bg-red-900 p-2 rounded text-center">
                        <div class="font-semibold text-red-800 dark:text-red-200">Worst</div>
                        <div class="font-mono text-red-900 dark:text-red-100">${complexity.time.worst}</div>
                    </div>
                </div>
                
                <div class="text-xs space-y-1 bg-gray-100 dark:bg-gray-700 p-2 rounded">
                    <div class="flex justify-between">
                        <span class="font-semibold">ï¿½ Space Complexity:</span>
                        <span class="font-mono">${complexity.space}</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="font-semibold">ðŸ”’ Stability:</span>
                        <span>${complexity.stable ? 'âœ… Stable' : 'âŒ Unstable'}</span>
                    </div>
                </div>
                
                <div class="text-xs mt-2 p-2 bg-indigo-50 dark:bg-indigo-900 rounded italic text-gray-700 dark:text-gray-300">
                    ðŸ’¡ ${complexity.description}
                </div>
            </div>
        </div>
    `;
}

// ===== UTILITY FUNCTIONS =====
function highlight(i, j, color, containerSelector = "#array-visualizer") {
    const boxes = d3.select(containerSelector).selectAll("div.data-box").nodes();
    if (boxes[i]) d3.select(boxes[i]).style("background-color", color);
    if (j !== undefined && boxes[j]) d3.select(boxes[j]).style("background-color", color);
}

function unhighlight(i, j, containerSelector = "#array-visualizer") {
    const boxes = d3.select(containerSelector).selectAll("div.data-box").nodes();
    const primaryColor = html.classList.contains('dark') ? "var(--primary-dark)" : "var(--primary-light)";
    if (boxes[i]) d3.select(boxes[i]).style("background-color", primaryColor);
    if (j !== undefined && boxes[j]) d3.select(boxes[j]).style("background-color", primaryColor);
}

function highlightRange(start, end, color, containerSelector = "#array-visualizer") {
    d3.select(containerSelector)
        .selectAll("div.data-box")
        .filter((d, i) => i >= start && i <= end)
        .style("background-color", color);
}

function unhighlightRange(start, end, containerSelector = "#array-visualizer") {
    const primaryColor = html.classList.contains('dark') ? "var(--primary-dark)" : "var(--primary-light)";
    d3.select(containerSelector)
        .selectAll("div.data-box")
        .filter((d, i) => i >= start && i <= end)
        .style("background-color", primaryColor);
}

function updateColors(containerSelector) {
    const primaryColor = html.classList.contains('dark') ? "var(--primary-dark)" : "var(--primary-light)";
    d3.select(containerSelector)
        .selectAll(".data-box")
        .style("background-color", primaryColor);
}

// ===== ALGORITHM RUNNER =====
async function runAlgorithm() {
    console.log('runAlgorithm called');
    if (isAnimating) {
        console.log('Already animating, returning');
        return;
    }

    const selectedAlgo = algorithmSelect.value;
    console.log('Selected algorithm:', selectedAlgo);
    console.log('Current structure:', currentStructure);
    
    const helpers = {
        render: (data, pointers) => renderArray(data, "#array-visualizer", pointers),
        highlight: (i, j, color) => highlight(i, j, color, "#array-visualizer"),
        unhighlight: (i, j) => unhighlight(i, j, "#array-visualizer"),
        highlightRange: (start, end, color) => highlightRange(start, end, color, "#array-visualizer"),
        unhighlightRange: (start, end) => unhighlightRange(start, end, "#array-visualizer")
    };

    isAnimating = true;
    try {
        if (selectedAlgo === 'Bubble Sort') await bubbleSort(arrayData, helpers);
        else if (selectedAlgo === 'Selection Sort') await selectionSort(arrayData, helpers);
        else if (selectedAlgo === 'Insertion Sort') await insertionSort(arrayData, helpers);
        else if (selectedAlgo === 'Merge Sort') await mergeSort(arrayData, helpers);
        else if (selectedAlgo === 'Quick Sort') await quickSort(arrayData, helpers);
        else if (selectedAlgo === 'Linear Search') await linearSearch(helpers);
        else if (selectedAlgo === 'Binary Search') await binarySearch(helpers);
        else if (selectedAlgo === 'Insert') await insertElement(helpers);
        else if (selectedAlgo === 'Delete') await deleteElement(helpers);
        else if (selectedAlgo === 'Push') {
            console.log('Calling stackPush');
            await stackPush();
        }
        else if (selectedAlgo === 'Pop') {
            console.log('Calling stackPop');
            await stackPop();
        }
        else if (selectedAlgo === 'Enqueue') {
            console.log('Calling queueEnqueue');
            await queueEnqueue();
        }
        else if (selectedAlgo === 'Dequeue') {
            console.log('Calling queueDequeue');
            await queueDequeue();
        }
        console.log('Algorithm execution completed');
    } finally {
        isAnimating = false;
        console.log('isAnimating set to false');
    }
}

// ===== ALGORITHM SPECIFIC CONTROLS =====
function updateAlgoSpecificControls() {
    algoSpecificControls.innerHTML = '';
    const selectedAlgo = algorithmSelect.value;
    
    const createInput = (id, label, placeholder, type = 'number') => {
        return `<div>
            <label for="${id}" class="block text-sm font-medium text-gray-700 dark:text-gray-300">${label}</label>
            <input id="${id}" type="${type}" placeholder="${placeholder}" class="form-input mt-1">
        </div>`;
    };

    if (currentStructure === 'stacks') {
        // Always show value input for stacks
        algoSpecificControls.innerHTML = createInput('value-input', 'Value', 'e.g., 42');
    } else if (currentStructure === 'queues') {
        // Always show value input for queues
        algoSpecificControls.innerHTML = createInput('value-input', 'Value', 'e.g., 42');
    } else if (currentStructure === 'arrays') {
        if (selectedAlgo === 'Insert') {
            algoSpecificControls.innerHTML = createInput('value-to-insert', 'Value', 'e.g., 10') + 
                                            createInput('index-to-insert', 'Index', 'e.g., 2');
        } else if (selectedAlgo === 'Delete') {
            algoSpecificControls.innerHTML = createInput('index-to-delete', 'Index', 'e.g., 2');
        } else if (selectedAlgo.includes('Search')) {
            algoSpecificControls.innerHTML = createInput('search-value', 'Target Value', 'e.g., 7');
        }
    }
}

// ===== OTHER HANDLERS =====
function handleSpeedChange(e) {
    animationSpeed = 1100 - e.target.value;
}

function handleWindowResize() {
    if (currentView === 'visualizer') resetData();
    if (currentView === 'comparison') resetComparison();
}

</script>
</body>
</html>
