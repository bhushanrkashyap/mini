{% extends "algosphere/base.html" %}
{% load static %}

{% block title %}Authentication{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/auth-premium.css' %}">
{% endblock %}

{% block content %}
<!-- Background Animator -->
<div class="background-animator">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
  <div class="blob blob-3"></div>
</div>

<!-- Floating Particles -->
<div class="particles" id="particles-container"></div>

<!-- Auth Wrapper -->
<div class="auth-wrapper">
  <div class="auth-card">
    <!-- Header -->
    <div class="auth-header">
      <div class="logo-container">
        <div class="logo-icon">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
          </svg>
        </div>
      </div>
      <h1 class="auth-title">AlgoSphere</h1>
      <p class="auth-subtitle">Master Algorithms & Data Structures</p>
    </div>

    <!-- Messages -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
          <svg class="alert-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
            {% if message.tags == 'error' %}
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
            {% else %}
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            {% endif %}
          </svg>
          <span>{{ message }}</span>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Tabs Navigation -->
    <div class="tab-container">
      <button class="tab-btn active" onclick="switchTab('login', event)">Login</button>
      <button class="tab-btn" onclick="switchTab('signup', event)">Sign Up</button>
    </div>

    <!-- LOGIN FORM -->
    <form id="login" class="form-section active" method="POST" action="{% url 'algosphere:auth' %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="login">
      
      <div class="form-group">
        <label for="login-username">Username</label>
        <input 
          id="login-username" 
          name="username" 
          type="text" 
          required 
          placeholder="Enter your username"
          autocomplete="username">
      </div>

      <div class="form-group">
        <label for="login-password">Password</label>
        <input 
          id="login-password" 
          name="password" 
          type="password" 
          required 
          placeholder="Enter your password"
          autocomplete="current-password">
      </div>

      <button type="submit" class="submit-btn">Sign In</button>
    </form>

    <!-- SIGNUP FORM -->
    <form id="signup" class="form-section" method="POST" action="{% url 'algosphere:auth' %}">
      {% csrf_token %}
      <input type="hidden" name="action" value="signup">
      
      <div class="form-group">
        <label for="signup-username">Username</label>
        <input 
          id="signup-username" 
          name="username" 
          type="text" 
          required 
          placeholder="Choose a username"
          autocomplete="username">
      </div>

      <div class="form-group">
        <label for="signup-dob">Date of Birth</label>
        <input 
          id="signup-dob" 
          name="dob" 
          type="date" 
          required>
      </div>

      <div class="form-group">
        <label for="signup-password">Password</label>
        <input 
          id="signup-password" 
          name="password" 
          type="password" 
          required 
          placeholder="Create a strong password"
          autocomplete="new-password">
      </div>

      <div class="form-group">
        <label for="signup-password2">Confirm Password</label>
        <input 
          id="signup-password2" 
          name="password2" 
          type="password" 
          required 
          placeholder="Confirm your password"
          autocomplete="new-password">
      </div>

      <button type="submit" class="submit-btn">Create Account</button>
    </form>
  </div>
</div>

<script>
  // ==========================================
  // TAB SWITCHING WITH ANIMATION
  // ==========================================
  function switchTab(tabName, event) {
    event.preventDefault();
    
    // Hide all forms with fade-out
    const forms = document.querySelectorAll('.form-section');
    forms.forEach(form => {
      form.classList.remove('active');
    });
    
    // Remove active class from all tabs
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(tab => {
      tab.classList.remove('active');
    });
    
    // Show selected form and mark tab as active
    setTimeout(() => {
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
    }, 50);
  }

  // ==========================================
  // FLOATING PARTICLES ANIMATION
  // ==========================================
  function createParticles() {
    const container = document.getElementById('particles-container');
    const particleCount = 30;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.className = 'particle';
      
      const x = Math.random() * 100;
      const y = Math.random() * 100;
      const duration = 15 + Math.random() * 20;
      const delay = Math.random() * 5;
      
      particle.style.left = x + '%';
      particle.style.top = y + '%';
      particle.style.animationDuration = duration + 's';
      particle.style.animationDelay = delay + 's';
      
      container.appendChild(particle);
    }
  }

  // Initialize particles on page load
  document.addEventListener('DOMContentLoaded', createParticles);

  // ==========================================
  // INPUT FOCUS ANIMATION
  // ==========================================
  const inputs = document.querySelectorAll('input');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.style.transform = 'scale(1.02)';
    });
    input.addEventListener('blur', function() {
      this.parentElement.style.transform = 'scale(1)';
    });
  });

  // ==========================================
  // SMOOTH SCROLL TO FORM ON ERROR/SUCCESS
  // ==========================================
  const alerts = document.querySelectorAll('.alert');
  if (alerts.length > 0) {
    alerts[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
</script>
{% endblock %}
